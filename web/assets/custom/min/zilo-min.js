!function(){function e(e){var t=$(".js-customers");$.ajax({url:"/calendar/customers.json",data:{start:e.start.format(),end:e.end.format()}}).done(function(e){if(!e||!e.length)return void t.hide();var a=t.find(".list-group");a.empty(),_.each(e,function(e){a.append(r(e))}),t.show()}).fail(function(){t.hide()})}function t(e){var t=$(d(e));$(".calendar-container").append(t),t.find("input[name=starts]").datepicker({format:"dd/mm/yyyy",todayHighlight:!0}),t.modal("show").one("hidden.bs.modal",function(e){t.remove()})}function a(){return $(".js-calendars .list-group-item:not(.deleted)").map(function(e,t){var a=$(t),n=a.data("type"),r=a.data("color"),d=a.data("textColor");return{id:n,url:"/calendar/feed.json",data:{type:n},color:r,textColor:d,error:function(){}}}).get()}function n(e){var t=$(".js-calendars .list-group-item").filter(function(){return $(this).data("type")==e});if(!t.length)return null;var e=t.data("type"),a=t.data("color"),n=t.data("textColor");return{id:e,url:"/calendar/feed.json",data:{type:e},color:a,textColor:n,error:function(){}}}var r=_.template($("#CustomerTpl").html()),d=_.template($("#EventTpl").html());$(document).ready(function(){var r={eventSources:a(),defaultDate:moment(),locale:$("html").attr("lang")||"en",displayEventTime:!1,selectable:!1,editable:!1,droppable:!1,eventLimit:!0,header:{left:"month,agendaWeek,agendaDay",center:"prev,title,next",right:"listDay,listWeek"},aspectRatio:1.7,selectHelper:!0,loading:function(t,a){t||e(a)},eventClick:t},d=void 0,l=Object.assign({},r);l.aspectRatio=.5,d=$(window).outerWidth()<667?l:r,$("#calendar").fullCalendar(d),$("#calendar .fc-listDay-button").text("it"==r?"Agenda Giorno":"List Day"),$("#calendar .fc-listWeek-button").text("it"==r?"Agenda Settimana":"List Week"),$(".js-calendars").on("click",".list-group-item",function(e){e.preventDefault();var t=$(e.currentTarget),a=t.find(".btn .icon"),r=t.data("type");t.hasClass("deleted")?(t.removeClass("deleted"),a.removeClass("md-eye").addClass("md-delete"),$("#calendar").fullCalendar("addEventSource",n(r))):(t.addClass("deleted"),a.addClass("md-eye").removeClass("md-delete"),$("#calendar").fullCalendar("removeEventSource",r))}),$("button.js-print").click(function(){window.print()})})}();